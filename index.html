<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photography Room 7209 Booking System</title>
    <!-- External configuration file (keep credentials separate) -->
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .booking-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .calendar-section {
            padding: 40px;
            background: white;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 25px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input[readonly] {
            background-color: #f8f9fa !important;
            cursor: not-allowed !important;
            border-color: #e9ecef;
        }

        .form-group input[readonly]:focus {
            border-color: #e9ecef;
            box-shadow: none;
        }

        .login-required-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
        }

        .calendar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background 0.3s ease;
        }

        .calendar-nav:hover {
            background: #5a6fd8;
        }

        .calendar-month {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day-header {
            text-align: center;
            padding: 10px;
            font-weight: 600;
            color: #666;
            font-size: 0.9em;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background: #e8edff;
        }

        .calendar-day.selected {
            background: #667eea;
            color: white;
        }

        .calendar-day.booked {
            background: #ff6b6b;
            color: white;
            cursor: not-allowed;
        }

        .calendar-day.today {
            background: #2c3e50;
            color: white;
        }

        .time-slots {
            margin-top: 20px;
        }

        .time-step {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
            transition: all 0.3s ease;
        }

        .time-step h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.2em;
            font-weight: 600;
        }

        .time-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }

        .time-button {
            padding: 10px 8px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            color: #2c3e50;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            position: relative;
        }

        .time-button:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-1px);
        }

        .time-button.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .time-button.disabled {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
            border-color: #ddd;
        }

        .time-button.disabled:hover {
            transform: none;
            background: #f5f5f5;
            border-color: #ddd;
        }

        .time-button.conflict {
            background: #ffe6e6;
            color: #dc3545;
            border-color: #dc3545;
            cursor: not-allowed;
        }

        .time-button.conflict::after {
            content: 'üö´';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7em;
        }

        .time-button:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .time-button:focus:not(.conflict) {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .time-button.selected:focus {
            outline-color: #ffffff;
        }

        .time-buttons-loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .time-buttons-loading::after {
            content: 'Loading times...';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 500;
            color: #666;
        }

        .selected-start-time {
            background: #e8f4fd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
            border-left: 4px solid #667eea;
        }

        .change-start-time-btn {
            margin-top: 15px;
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .change-start-time-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .time-selection-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .time-selection-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
        }

        .time-selection-group h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .time-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        .time-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .time-info {
            margin-top: 15px;
            padding: 12px;
            background: #e8f4fd;
            border-left: 4px solid #667eea;
            border-radius: 5px;
            font-size: 0.9em;
            color: #2c3e50;
        }

        .duration-display {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 5px;
            text-align: center;
            font-weight: 600;
            color: #856404;
        }

        .booking-timeline {
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e1e5e9;
        }

        .timeline-hour {
            display: flex;
            align-items: center;
            height: 40px;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }

        .timeline-hour:last-child {
            border-bottom: none;
        }

        .timeline-time {
            min-width: 80px;
            font-weight: 500;
            color: #666;
            font-size: 0.9em;
        }

        .timeline-bar {
            flex: 1;
            height: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-left: 15px;
            position: relative;
            border: 1px solid #e1e5e9;
        }

        .timeline-booking {
            position: absolute;
            background: #ff6b6b;
            height: 100%;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: 500;
        }

        .timeline-selected {
            position: absolute;
            background: #667eea;
            height: 100%;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: 500;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .bookings-list {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .booking-item {
            padding: 15px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .booking-date {
            font-weight: 600;
            color: #2c3e50;
        }

        .booking-details {
            margin-top: 5px;
            color: #666;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .admin-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .user-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1001;
        }

        .user-controls.hidden {
            display: none;
        }

        .left-sidebar {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            min-width: 250px;
            display: none;
        }

        .left-sidebar.show {
            display: block;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
        }

        .user-info h4 {
            color: #2c3e50;
            margin: 0;
            font-size: 1.1em;
        }

        .user-info p {
            color: #666;
            margin: 0;
            font-size: 0.9em;
        }

        .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-align: left;
        }

        .sidebar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .sidebar-btn.logout {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .sidebar-btn.logout:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .sidebar-btn.admin {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        .sidebar-btn.admin:hover {
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.3);
        }

        .user-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
            min-width: 90px;
            text-align: center;
        }

        .user-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .user-btn.logged-in {
            background: rgba(102, 126, 234, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .admin-toggle {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
            min-width: 90px;
            text-align: center;
        }

        .admin-toggle.logged-in {
            background: rgba(220, 53, 69, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .admin-toggle.logged-in:hover {
            background: rgba(220, 53, 69, 0.9);
            transform: scale(1.05);
        }

        .auth-modal {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-width: 350px;
            min-width: 300px;
        }

        .auth-tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-size: 1em;
            color: #666;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .auth-form h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group-auth {
            margin-bottom: 15px;
        }

        .form-group-auth label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group-auth input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group-auth input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .auth-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .auth-buttons button[type="submit"] {
            background: #667eea;
            color: white;
        }

        .auth-buttons button[type="submit"]:hover {
            background: #5a6fd8;
        }

        .auth-buttons button[type="button"] {
            background: #6c757d;
            color: white;
        }

        .auth-buttons button[type="button"]:hover {
            background: #545b62;
        }

        .auth-error {
            color: #dc3545;
            margin-top: 10px;
            text-align: center;
            font-size: 0.9em;
        }

        .logged-in-status {
            position: fixed;
            top: 70px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 0.9em;
            color: #2c3e50;
            z-index: 999;
            display: none;
        }

        .admin-booking {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }

        .admin-booking h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .admin-booking p {
            margin: 4px 0;
            font-size: 0.9em;
            color: #666;
        }

        .cancel-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .cancel-btn:hover {
            background: #c82333;
        }

        .booking-item {
            padding: 15px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            margin-bottom: 15px;
            border-radius: 8px;
            position: relative;
        }

        .booking-item .cancel-booking {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .booking-item .cancel-booking:hover {
            background: #c82333;
        }

        .email-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .email-status.sending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .email-status.sent {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .email-status.failed {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .student-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }

        .student-item h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .student-item p {
            margin: 4px 0;
            font-size: 0.9em;
            color: #666;
        }

        .student-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .student-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s ease;
        }

        .reset-password-btn {
            background: #ffc107;
            color: #212529;
        }

        .reset-password-btn:hover {
            background: #e0a800;
        }

        .delete-student-btn {
            background: #dc3545;
            color: white;
        }

        .delete-student-btn:hover {
            background: #c82333;
        }

        .view-bookings-btn {
            background: #17a2b8;
            color: white;
        }

        .view-bookings-btn:hover {
            background: #138496;
        }

        .reset-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1002;
        }

        .reset-modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .reset-modal-content h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .student-stats {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .time-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .user-controls {
                top: 10px;
                right: 10px;
                flex-direction: column;
                gap: 5px;
            }

            .left-sidebar {
                top: 10px;
                left: 10px;
                min-width: 220px;
                padding: 15px;
            }

            .sidebar-btn {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .user-avatar {
                width: 35px;
                height: 35px;
                font-size: 1em;
            }

            .user-info h4 {
                font-size: 1em;
            }

            .user-btn,
            .admin-toggle {
                min-width: 80px;
                font-size: 0.8em;
                padding: 6px 10px;
            }

            .logged-in-status {
                top: 90px;
                right: 10px;
                font-size: 0.8em;
                padding: 8px 12px;
            }

            .auth-modal {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                min-width: auto;
            }

            .time-buttons-grid {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                gap: 6px;
            }
            
            .time-button {
                padding: 8px 4px;
                font-size: 0.8em;
            }
            
            .time-step {
                padding: 15px;
            }
            
            .time-step h4 {
                font-size: 1.1em;
            }
        }

        @media (max-width: 480px) {
            .time-buttons-grid {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
                gap: 4px;
            }
            
            .time-button {
                padding: 6px 2px;
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ Photography Room 7209 Booking</h1>
            <p>Reserve your creative space for stunning photography sessions</p>
        </div>

        <!-- User Controls -->
        <div class="user-controls" id="userControls">
            <button class="user-btn" id="studentLoginBtn" aria-label="Student login and logout">Student Login</button>
            <button class="admin-toggle" id="adminToggle" aria-label="Admin login and logout">Admin Login</button>
        </div>

        <!-- Left Sidebar for Logged-in Users -->
        <div class="left-sidebar" id="leftSidebar">
            <div class="sidebar-header">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h4 id="sidebarUserName">User</h4>
                    <p id="sidebarUserType">Student</p>
                </div>
            </div>
            <div class="sidebar-actions">
                <button class="sidebar-btn" id="sidebarMyBookings" style="display: none;">
                    üìÖ My Bookings
                </button>
                <button class="sidebar-btn admin" id="sidebarAdminPanel" style="display: none;">
                    ‚öôÔ∏è Admin Panel
                </button>
                <button class="sidebar-btn admin" id="sidebarManageStudents" style="display: none;">
                    üë• Manage Students
                </button>
                <button class="sidebar-btn logout" id="sidebarLogout">
                    üö™ Logout
                </button>
            </div>
        </div>
        
        <!-- Logged-in Status -->
        <div id="loggedInStatus" class="logged-in-status" role="status" aria-live="polite"></div>
        
        <!-- Student Login/Register Modal -->
        <div id="studentAuthModal" class="auth-modal" style="display: none;" role="dialog" aria-labelledby="authModalTitle" aria-modal="true">
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab" role="tab" aria-selected="true" aria-controls="loginForm">Login</button>
                <button class="auth-tab" id="registerTab" role="tab" aria-selected="false" aria-controls="registerForm">Register</button>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form" role="tabpanel" aria-labelledby="loginTab">
                <h3 id="authModalTitle">Student Login</h3>
                <form id="studentLoginForm">
                    <div class="form-group-auth">
                        <label for="loginStudentId">Student ID:</label>
                        <input type="text" id="loginStudentId" required aria-describedby="loginError">
                    </div>
                    <div class="form-group-auth">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" required aria-describedby="loginError">
                    </div>
                    <div class="auth-buttons">
                        <button type="submit">Login</button>
                        <button type="button" id="cancelStudentAuth">Cancel</button>
                    </div>
                </form>
                <div id="loginError" class="auth-error" style="display: none;" role="alert"></div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;" role="tabpanel" aria-labelledby="registerTab">
                <h3>Create Student Account</h3>
                <form id="studentRegisterForm">
                    <div class="form-group-auth">
                        <label for="regStudentName">Full Name:</label>
                        <input type="text" id="regStudentName" required aria-describedby="registerError">
                    </div>
                    <div class="form-group-auth">
                        <label for="regStudentId">Student ID:</label>
                        <input type="text" id="regStudentId" required aria-describedby="registerError">
                    </div>
                    <div class="form-group-auth">
                        <label for="regEmail">Email:</label>
                        <input type="email" id="regEmail" required aria-describedby="registerError">
                    </div>
                    <div class="form-group-auth">
                        <label for="regPassword">Password:</label>
                        <input type="password" id="regPassword" required minlength="6" aria-describedby="registerError">
                    </div>
                    <div class="form-group-auth">
                        <label for="regConfirmPassword">Confirm Password:</label>
                        <input type="password" id="regConfirmPassword" required minlength="6" aria-describedby="registerError">
                    </div>
                    <div class="auth-buttons">
                        <button type="submit">Create Account</button>
                        <button type="button" id="cancelStudentAuth2">Cancel</button>
                    </div>
                </form>
                <div id="registerError" class="auth-error" style="display: none;" role="alert"></div>
            </div>
        </div>
        
        <!-- Admin Login Modal -->
        <div id="adminLoginModal" class="admin-panel" style="max-width: 300px; text-align: center;" role="dialog" aria-labelledby="adminLoginTitle" aria-modal="true">
            <h3 id="adminLoginTitle">Teacher Authentication</h3>
            <form id="adminLoginForm" style="margin-top: 20px;">
                <div style="margin-bottom: 15px;">
                    <label for="teacherId" style="display: block; margin-bottom: 5px; font-weight: 500;">Teacher ID:</label>
                    <input type="text" id="teacherId" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;" aria-describedby="loginError">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="password" style="display: block; margin-bottom: 5px; font-weight: 500;">Password:</label>
                    <input type="password" id="password" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;" aria-describedby="loginError">
                </div>
                <button type="submit" style="background: #2c3e50; color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Login</button>
                <button type="button" id="cancelLogin" style="background: #6c757d; color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer;">Cancel</button>
            </form>
            <div id="loginError" role="alert" style="color: #dc3545; margin-top: 10px; display: none;"></div>
        </div>
        
        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>Admin Dashboard - Room 7209</h3>
                <div style="display: flex; gap: 10px;">
                    <button id="manageStudentsBtn" style="background: #667eea; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em;">Manage Students</button>
                    <button id="logoutBtn" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em;">Logout</button>
                </div>
            </div>
            
            <div id="adminMainView">
                <p><strong>Total Bookings:</strong> <span id="totalBookings">0</span></p>
                <hr style="margin: 15px 0;">
                <div id="allBookings"></div>
            </div>
            
            <!-- Student Management View -->
            <div id="studentManagementView" style="display: none;">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                    <h4>Student Account Management</h4>
                    <button id="backToBookingsBtn" style="background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em;">Back to Bookings</button>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <p><strong>Total Students:</strong> <span id="totalStudents">0</span></p>
                    <input type="text" id="studentSearchInput" placeholder="Search by name or student ID..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 10px;">
                </div>
                
                <div id="studentsList"></div>
                
                <!-- Password Reset Modal -->
                <div id="passwordResetModal" class="reset-modal" style="display: none;">
                    <div class="reset-modal-content">
                        <h4>Reset Password</h4>
                        <p>Student: <strong id="resetStudentName"></strong></p>
                        <form id="passwordResetForm">
                            <div style="margin-bottom: 15px;">
                                <label for="newPassword">New Password:</label>
                                <input type="password" id="newPassword" required minlength="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="confirmNewPassword">Confirm Password:</label>
                                <input type="password" id="confirmNewPassword" required minlength="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button type="submit" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Reset Password</button>
                                <button type="button" id="cancelPasswordReset" style="background: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Cancel</button>
                            </div>
                        </form>
                        <div id="passwordResetError" style="color: #dc3545; margin-top: 10px; display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="alert" class="alert"></div>

        <div class="main-content">
            <div class="booking-section">
                <h2 class="section-title">Book Your Session</h2>
                
                <!-- Login Notice for Non-Logged-in Users -->
                <div id="loginNotice" class="login-required-notice" style="display: none;">
                    <p>üîê <strong>Student Login Required</strong></p>
                    <p>Please log in or create a student account to make a booking. Click "Student Login" in the top right corner.</p>
                </div>
                
                <form id="bookingForm">
                    <div class="form-group">
                        <label for="studentName">Student Name *</label>
                        <input type="text" id="studentName" required>
                    </div>

                    <div class="form-group">
                        <label for="studentId">Student ID *</label>
                        <input type="text" id="studentId" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" required>
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone">
                    </div>

                    <div class="form-group">
                        <label for="projectType">Project Type *</label>
                        <select id="projectType" required>
                            <option value="">Select project type</option>
                            <option value="portrait">Portrait Photography</option>
                            <option value="product">Product Photography</option>
                            <option value="fashion">Fashion Photography</option>
                            <option value="art">Art Photography</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="purpose">Purpose/Description</label>
                        <textarea id="purpose" rows="3" placeholder="Briefly describe your photography project..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="equipment">Equipment Needed</label>
                        <textarea id="equipment" rows="2" placeholder="List any specific equipment you need..."></textarea>
                    </div>

                    <button type="submit" class="btn" id="bookBtn" disabled>
                        Complete Booking
                    </button>
                </form>

                <div class="bookings-list">
                    <h3 class="section-title">Your Bookings</h3>
                    <div id="recentBookings"></div>
                </div>

                <!-- Email Status Display -->
                <div id="emailStatus" class="email-status" style="display: none;"></div>
            </div>

            <div class="calendar-section">
                <h2 class="section-title">Select Date & Time for Room 7209</h2>
                
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" id="prevMonth">‚Äπ</button>
                        <div class="calendar-month" id="currentMonth"></div>
                        <button class="calendar-nav" id="nextMonth">‚Ä∫</button>
                    </div>
                    
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div class="time-slots">
                    <h3>Select Your Booking Time - Room 7209</h3>
                    <div class="time-info">
                        üìÖ <strong>Booking Hours:</strong> 9:00 AM - 4:30 PM | <strong>Time Increments:</strong> 30 minutes | <strong>Minimum Duration:</strong> 1 hour | <strong>Maximum Duration:</strong> 7.5 hours
                    </div>
                    
                    <!-- Step 1: Start Time Selection -->
                    <div id="startTimeSelection" class="time-step">
                        <h4>üïò Step 1: Select Start Time</h4>
                        <div class="time-buttons-grid" id="startTimeButtons">
                            <!-- Start time buttons will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Step 2: End Time Selection (hidden initially) -->
                    <div id="endTimeSelection" class="time-step" style="display: none;">
                        <h4>üïò Step 2: Select End Time</h4>
                        <div class="selected-start-time" id="selectedStartTimeDisplay">
                            Start Time: <span id="startTimeDisplay">--:--</span>
                        </div>
                        <div class="time-buttons-grid" id="endTimeButtons">
                            <!-- End time buttons will be generated here -->
                        </div>
                        <button class="change-start-time-btn" id="changeStartTimeBtn" type="button">
                            ‚Üê Change Start Time
                        </button>
                    </div>
                    
                    <!-- Hidden inputs for form compatibility -->
                    <input type="hidden" id="startTime" name="startTime">
                    <input type="hidden" id="endTime" name="endTime"></div>
                    
                    <div id="durationDisplay" class="duration-display" style="display: none;">
                        Duration: <span id="durationText">0 hours</span>
                    </div>
                    
                    <div class="booking-timeline" id="bookingTimeline" style="display: none;">
                        <h4 style="margin-bottom: 15px; color: #2c3e50;">üìä Daily Timeline</h4>
                        <div id="timelineContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class BookingSystem {
            // Simple hash function for demo purposes (in production, use proper backend authentication)
            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32-bit integer
                }
                return Math.abs(hash).toString(16);
            }

            constructor() {
                this.currentDate = new Date();
                this.selectedDate = null;
                this.selectedStartTime = null;
                this.selectedEndTime = null;
                this.bookings = this.loadBookings();
                this.students = this.loadStudents();
                this.currentStudent = null;
                this.isAdminAuthenticated = false;
                this.currentAdminId = null;
                
                // Room operating hours
                this.roomOpenTime = '09:00';
                this.roomCloseTime = '16:30'; // 4:30 PM
                this.minDurationHours = 1;
                this.maxDurationHours = 7.5;
                
                // Generate correct hashes for debugging
                console.log('Hash for photo2024:', this.simpleHash('photo2024'));
                console.log('Hash for room7209:', this.simpleHash('room7209'));
                console.log('Hash for photography123:', this.simpleHash('photography123'));
                
                // Secure authentication - credentials are now hashed and not visible in source code
                this.teacherHashes = {
                    'Tia': this.simpleHash('photo2024'), // photo2024
                    'Bryn': this.simpleHash('room7209'), // room7209
                    'ADMIN': this.simpleHash('photography123')  // photography123
                };
                
                this.init();
            }

            init() {
                this.renderCalendar();
                this.renderTimeSelection();
                this.renderRecentBookings();
                this.updateStudentUI();
                this.updateSidebarUI();
                this.attachEventListeners();
            }

            attachEventListeners() {
                document.getElementById('prevMonth').addEventListener('click', () => this.changeMonth(-1));
                document.getElementById('nextMonth').addEventListener('click', () => this.changeMonth(1));
                document.getElementById('bookingForm').addEventListener('submit', (e) => this.handleBookingSubmit(e));
                document.getElementById('adminToggle').addEventListener('click', () => this.toggleAdminAction());
                document.getElementById('adminLoginForm').addEventListener('submit', (e) => this.handleAdminLogin(e));
                document.getElementById('cancelLogin').addEventListener('click', () => this.hideAdminLogin());
                document.getElementById('logoutBtn').addEventListener('click', () => this.handleAdminLogout());
                
                // Time selection events - button based
                document.getElementById('changeStartTimeBtn').addEventListener('click', () => this.resetTimeSelection());
                
                // Student authentication events
                document.getElementById('studentLoginBtn').addEventListener('click', () => this.showStudentAuth());
                document.getElementById('loginTab').addEventListener('click', () => this.showLoginForm());
                document.getElementById('registerTab').addEventListener('click', () => this.showRegisterForm());
                document.getElementById('studentLoginForm').addEventListener('submit', (e) => this.handleStudentLogin(e));
                document.getElementById('studentRegisterForm').addEventListener('submit', (e) => this.handleStudentRegister(e));
                document.getElementById('cancelStudentAuth').addEventListener('click', () => this.hideStudentAuth());
                document.getElementById('cancelStudentAuth2').addEventListener('click', () => this.hideStudentAuth());
                
                // Sidebar events
                document.getElementById('sidebarLogout').addEventListener('click', () => this.handleSidebarLogout());
                document.getElementById('sidebarMyBookings').addEventListener('click', () => this.scrollToBookings());
                document.getElementById('sidebarAdminPanel').addEventListener('click', () => this.showAdminPanel());
                document.getElementById('sidebarManageStudents').addEventListener('click', () => this.showStudentManagement());
                
                // Admin student management events
                document.getElementById('manageStudentsBtn').addEventListener('click', () => this.showStudentManagement());
                document.getElementById('backToBookingsBtn').addEventListener('click', () => this.showBookingsView());
                document.getElementById('studentSearchInput').addEventListener('input', (e) => this.searchStudents(e.target.value));
                document.getElementById('passwordResetForm').addEventListener('submit', (e) => this.handlePasswordReset(e));
                document.getElementById('cancelPasswordReset').addEventListener('click', () => this.hidePasswordResetModal());
                
                // Keyboard accessibility - ESC key closes modals
                document.addEventListener('keydown', (e) => this.handleKeyboardNavigation(e));
                
                // Form validation listeners
                const form = document.getElementById('bookingForm');
                const inputs = form.querySelectorAll('input[required], select[required]');
                inputs.forEach(input => {
                    input.addEventListener('input', () => this.validateForm());
                });
            }

            handleKeyboardNavigation(e) {
                if (e.key === 'Escape') {
                    // Close any open modals with ESC key
                    if (document.getElementById('studentAuthModal').style.display === 'block') {
                        this.hideStudentAuth();
                    }
                    if (document.getElementById('adminLoginModal').style.display === 'block') {
                        this.hideAdminLogin();
                    }
                    if (document.getElementById('passwordResetModal').style.display === 'flex') {
                        this.hidePasswordResetModal();
                    }
                }
            }

            showAdminLogin() {
                if (this.isAdminAuthenticated) {
                    this.showAdminPanel();
                } else {
                    // Close any other open modals first
                    this.hideStudentAuth();
                    
                    document.getElementById('adminLoginModal').style.display = 'block';
                    document.getElementById('adminPanel').style.display = 'none';
                    
                    // Focus management for accessibility
                    setTimeout(() => {
                        document.getElementById('teacherId').focus();
                    }, 100);
                }
            }

            toggleAdminAction() {
                if (this.isAdminAuthenticated) {
                    this.handleAdminLogout();
                } else {
                    this.showAdminLogin();
                }
            }

            hideAdminLogin() {
                document.getElementById('adminLoginModal').style.display = 'none';
                document.getElementById('loginError').style.display = 'none';
                document.getElementById('adminLoginForm').reset();
                
                // Return focus to trigger element for accessibility
                document.getElementById('adminToggle').focus();
            }

            handleAdminLogin(e) {
                e.preventDefault();
                const teacherId = document.getElementById('teacherId').value.trim();
                const password = document.getElementById('password').value;
                const errorEl = document.getElementById('loginError');
                
                // Hash the entered password and compare with stored hash
                const passwordHash = this.simpleHash(password);
                
                if (this.teacherHashes[teacherId] === passwordHash) {
                    this.isAdminAuthenticated = true;
                    this.currentAdminId = teacherId;
                    this.hideAdminLogin();
                    this.showAdminPanel();
                    this.updateSidebarUI();
                    this.showAlert(`Welcome, ${teacherId}! Admin access granted.`, 'success');
                } else {
                    errorEl.textContent = 'Invalid Teacher ID or Password';
                    errorEl.style.display = 'block';
                }
            }

            handleAdminLogout() {
                this.isAdminAuthenticated = false;
                this.currentAdminId = null;
                document.getElementById('adminPanel').style.display = 'none';
                this.updateSidebarUI();
                this.showAlert('Logged out successfully.', 'success');
            }

            // Student Authentication Methods
            showStudentAuth() {
                if (this.currentStudent) {
                    this.handleStudentLogout();
                } else {
                    // Close any other open modals first
                    this.hideAdminLogin();
                    document.getElementById('adminPanel').style.display = 'none';
                    
                    document.getElementById('studentAuthModal').style.display = 'block';
                    this.showLoginForm();
                    
                    // Focus management for accessibility
                    setTimeout(() => {
                        document.getElementById('loginStudentId').focus();
                    }, 100);
                }
            }

            hideStudentAuth() {
                document.getElementById('studentAuthModal').style.display = 'none';
                document.getElementById('loginError').style.display = 'none';
                document.getElementById('registerError').style.display = 'none';
                document.getElementById('studentLoginForm').reset();
                document.getElementById('studentRegisterForm').reset();
                
                // Return focus to trigger element
                document.getElementById('studentLoginBtn').focus();
            }

            showLoginForm() {
                document.getElementById('loginTab').classList.add('active');
                document.getElementById('registerTab').classList.remove('active');
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                
                // Update ARIA attributes
                document.getElementById('loginTab').setAttribute('aria-selected', 'true');
                document.getElementById('registerTab').setAttribute('aria-selected', 'false');
                document.getElementById('authModalTitle').textContent = 'Student Login';
            }

            showRegisterForm() {
                document.getElementById('registerTab').classList.add('active');
                document.getElementById('loginTab').classList.remove('active');
                document.getElementById('registerForm').style.display = 'block';
                document.getElementById('loginForm').style.display = 'none';
                
                // Update ARIA attributes
                document.getElementById('registerTab').setAttribute('aria-selected', 'true');
                document.getElementById('loginTab').setAttribute('aria-selected', 'false');
                document.getElementById('authModalTitle').textContent = 'Create Student Account';
            }

            handleStudentLogin(e) {
                e.preventDefault();
                const studentId = document.getElementById('loginStudentId').value.trim();
                const password = document.getElementById('loginPassword').value;
                const errorEl = document.getElementById('loginError');
                
                const student = this.students.find(s => s.studentId === studentId);
                
                if (student && student.passwordHash === this.simpleHash(password)) {
                    this.currentStudent = student;
                    this.hideStudentAuth();
                    this.updateStudentUI();
                    this.updateSidebarUI();
                    this.showAlert(`Welcome back, ${student.name}!`, 'success');
                    this.renderRecentBookings(); // Refresh to show only student's bookings
                } else {
                    errorEl.textContent = 'Invalid Student ID or Password';
                    errorEl.style.display = 'block';
                }
            }

            handleStudentRegister(e) {
                e.preventDefault();
                const name = document.getElementById('regStudentName').value.trim();
                const studentId = document.getElementById('regStudentId').value.trim();
                const email = document.getElementById('regEmail').value.trim();
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                const errorEl = document.getElementById('registerError');
                
                // Validation
                if (password !== confirmPassword) {
                    errorEl.textContent = 'Passwords do not match';
                    errorEl.style.display = 'block';
                    return;
                }
                
                if (this.students.find(s => s.studentId === studentId)) {
                    errorEl.textContent = 'Student ID already exists';
                    errorEl.style.display = 'block';
                    return;
                }
                
                if (this.students.find(s => s.email === email)) {
                    errorEl.textContent = 'Email already exists';
                    errorEl.style.display = 'block';
                    return;
                }
                
                // Create new student account
                const newStudent = {
                    id: Date.now(),
                    name: name,
                    studentId: studentId,
                    email: email,
                    passwordHash: this.simpleHash(password),
                    createdAt: new Date().toISOString()
                };
                
                this.students.push(newStudent);
                this.saveStudents();
                this.currentStudent = newStudent;
                this.hideStudentAuth();
                this.updateStudentUI();
                this.updateSidebarUI();
                this.showAlert(`Account created successfully! Welcome, ${name}!`, 'success');
                this.renderRecentBookings();
            }

            handleStudentLogout() {
                this.currentStudent = null;
                this.updateStudentUI();
                this.updateSidebarUI();
                this.showAlert('Logged out successfully.', 'success');
                this.renderRecentBookings(); // Refresh to show all bookings or none
            }

            updateStudentUI() {
                const loginNotice = document.getElementById('loginNotice');
                
                if (this.currentStudent) {
                    loginNotice.style.display = 'none'; // Hide login notice
                    
                    // Pre-fill form with student data and make fields readonly
                    const nameField = document.getElementById('studentName');
                    const idField = document.getElementById('studentId');
                    const emailField = document.getElementById('email');
                    
                    nameField.value = this.currentStudent.name;
                    idField.value = this.currentStudent.studentId;
                    emailField.value = this.currentStudent.email;
                    
                    // Make personal info fields readonly and style them
                    nameField.readOnly = true;
                    idField.readOnly = true;
                    emailField.readOnly = true;
                    
                    // Add visual styling to show they're locked
                    nameField.style.backgroundColor = '#f8f9fa';
                    nameField.style.cursor = 'not-allowed';
                    idField.style.backgroundColor = '#f8f9fa';
                    idField.style.cursor = 'not-allowed';
                    emailField.style.backgroundColor = '#f8f9fa';
                    emailField.style.cursor = 'not-allowed';
                    
                    // Update form labels to show they're pre-filled
                    nameField.previousElementSibling.innerHTML = 'Student Name * <span style="color: #28a745; font-size: 0.8em;">(Auto-filled)</span>';
                    idField.previousElementSibling.innerHTML = 'Student ID * <span style="color: #28a745; font-size: 0.8em;">(Auto-filled)</span>';
                    emailField.previousElementSibling.innerHTML = 'Email * <span style="color: #28a745; font-size: 0.8em;">(Auto-filled)</span>';
                    
                } else {
                    loginNotice.style.display = 'block'; // Show login notice
                    
                    // Clear and enable form fields
                    const nameField = document.getElementById('studentName');
                    const idField = document.getElementById('studentId');
                    const emailField = document.getElementById('email');
                    
                    nameField.value = '';
                    idField.value = '';
                    emailField.value = '';
                    
                    // Remove readonly and styling
                    nameField.readOnly = false;
                    idField.readOnly = false;
                    emailField.readOnly = false;
                    
                    nameField.style.backgroundColor = '';
                    nameField.style.cursor = '';
                    idField.style.backgroundColor = '';
                    idField.style.cursor = '';
                    emailField.style.backgroundColor = '';
                    emailField.style.cursor = '';
                    
                    // Reset labels
                    nameField.previousElementSibling.innerHTML = 'Student Name *';
                    idField.previousElementSibling.innerHTML = 'Student ID *';
                    emailField.previousElementSibling.innerHTML = 'Email *';
                }
                
                this.validateForm();
            }

            showAdminPanel() {
                if (this.isAdminAuthenticated) {
                    document.getElementById('adminPanel').style.display = 'block';
                    document.getElementById('adminLoginModal').style.display = 'none';
                    this.showBookingsView(); // Default to bookings view
                }
            }

            showBookingsView() {
                document.getElementById('adminMainView').style.display = 'block';
                document.getElementById('studentManagementView').style.display = 'none';
                this.renderAdminPanel();
            }

            showStudentManagement() {
                document.getElementById('adminMainView').style.display = 'none';
                document.getElementById('studentManagementView').style.display = 'block';
                this.renderStudentManagement();
            }

            renderStudentManagement() {
                const totalStudentsEl = document.getElementById('totalStudents');
                const studentsListEl = document.getElementById('studentsList');
                
                totalStudentsEl.textContent = this.students.length;
                
                this.renderStudentsList(this.students);
            }

            renderStudentsList(studentsToShow) {
                const studentsListEl = document.getElementById('studentsList');
                
                if (studentsToShow.length === 0) {
                    studentsListEl.innerHTML = '<p style="color: #666; text-align: center;">No students found</p>';
                    return;
                }
                
                const sortedStudents = studentsToShow.sort((a, b) => a.name.localeCompare(b.name));
                
                studentsListEl.innerHTML = sortedStudents.map(student => {
                    const studentBookings = this.bookings.filter(booking => 
                        booking.studentAccountId === student.id || 
                        (booking.studentId === student.studentId && !booking.studentAccountId)
                    );
                    
                    return `
                        <div class="student-item">
                            <h4>${student.name} (${student.studentId})</h4>
                            <p><strong>Email:</strong> ${student.email}</p>
                            <p><strong>Joined:</strong> ${new Date(student.createdAt).toLocaleDateString()}</p>
                            <div class="student-stats">
                                <p><strong>Total Bookings:</strong> ${studentBookings.length}</p>
                                <p><strong>Upcoming Bookings:</strong> ${studentBookings.filter(b => new Date(b.date) >= new Date()).length}</p>
                            </div>
                            <div class="student-actions">
                                <button class="reset-password-btn" onclick="bookingSystem.showPasswordResetModal('${student.id}')">
                                    Reset Password
                                </button>
                                <button class="view-bookings-btn" onclick="bookingSystem.viewStudentBookings('${student.id}')">
                                    View Bookings (${studentBookings.length})
                                </button>
                                <button class="delete-student-btn" onclick="bookingSystem.deleteStudentAccount('${student.id}')">
                                    Delete Account
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            searchStudents(searchTerm) {
                const filteredStudents = this.students.filter(student => 
                    student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    student.studentId.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    student.email.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                this.renderStudentsList(filteredStudents);
            }

            showPasswordResetModal(studentId) {
                const student = this.students.find(s => s.id == studentId);
                if (!student) return;
                
                document.getElementById('resetStudentName').textContent = `${student.name} (${student.studentId})`;
                document.getElementById('passwordResetModal').style.display = 'flex';
                document.getElementById('passwordResetModal').dataset.studentId = studentId;
                
                // Clear form
                document.getElementById('passwordResetForm').reset();
                document.getElementById('passwordResetError').style.display = 'none';
            }

            hidePasswordResetModal() {
                document.getElementById('passwordResetModal').style.display = 'none';
                document.getElementById('passwordResetForm').reset();
                document.getElementById('passwordResetError').style.display = 'none';
            }

            handlePasswordReset(e) {
                e.preventDefault();
                const studentId = document.getElementById('passwordResetModal').dataset.studentId;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                const errorEl = document.getElementById('passwordResetError');
                
                if (newPassword !== confirmPassword) {
                    errorEl.textContent = 'Passwords do not match';
                    errorEl.style.display = 'block';
                    return;
                }
                
                // Find and update student password
                const studentIndex = this.students.findIndex(s => s.id == studentId);
                if (studentIndex !== -1) {
                    this.students[studentIndex].passwordHash = this.simpleHash(newPassword);
                    this.saveStudents();
                    
                    this.hidePasswordResetModal();
                    this.showAlert(`Password reset successfully for ${this.students[studentIndex].name}`, 'success');
                }
            }

            deleteStudentAccount(studentId) {
                const student = this.students.find(s => s.id == studentId);
                if (!student) return;
                
                const studentBookings = this.bookings.filter(booking => 
                    booking.studentAccountId === student.id || 
                    (booking.studentId === student.studentId && !booking.studentAccountId)
                );
                
                let confirmMessage = `Are you sure you want to delete ${student.name}'s account?`;
                if (studentBookings.length > 0) {
                    confirmMessage += `\n\nThis will also delete ${studentBookings.length} associated booking(s).`;
                }
                
                if (confirm(confirmMessage)) {
                    // Remove student account
                    this.students = this.students.filter(s => s.id != studentId);
                    this.saveStudents();
                    
                    // Remove associated bookings
                    const originalBookingCount = this.bookings.length;
                    this.bookings = this.bookings.filter(booking => 
                        booking.studentAccountId !== student.id && 
                        !(booking.studentId === student.studentId && !booking.studentAccountId)
                    );
                    this.saveBookings();
                    
                    const deletedBookings = originalBookingCount - this.bookings.length;
                    
                    // If current student is deleted, log them out
                    if (this.currentStudent && this.currentStudent.id == studentId) {
                        this.handleStudentLogout();
                    }
                    
                    this.showAlert(`Account deleted successfully. ${deletedBookings} booking(s) were also removed.`, 'success');
                    this.renderStudentManagement();
                    this.renderCalendar(); // Refresh calendar to update booked dates
                    this.renderTimeSelection(); // Refresh time selection
                }
            }

            viewStudentBookings(studentId) {
                const student = this.students.find(s => s.id == studentId);
                if (!student) return;
                
                const studentBookings = this.bookings.filter(booking => 
                    booking.studentAccountId === student.id || 
                    (booking.studentId === student.studentId && !booking.studentAccountId)
                );
                
                if (studentBookings.length === 0) {
                    alert(`${student.name} has no bookings.`);
                    return;
                }
                
                const sortedBookings = studentBookings.sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));
                
                const bookingsList = sortedBookings.map(booking => {
                    const bookingDate = new Date(booking.date);
                    const isUpcoming = bookingDate >= new Date();
                    const status = isUpcoming ? '(Upcoming)' : '(Past)';
                    
                    return `‚Ä¢ ${booking.date} ${booking.time} - ${booking.projectType} ${status}`;
                }).join('\n');
                
                alert(`${student.name}'s Bookings:\n\n${bookingsList}`);
            }

            renderAdminPanel() {
                const totalBookingsEl = document.getElementById('totalBookings');
                const allBookingsEl = document.getElementById('allBookings');
                
                totalBookingsEl.textContent = this.bookings.length;
                
                if (this.bookings.length === 0) {
                    allBookingsEl.innerHTML = '<p style="color: #666; text-align: center;">No bookings found</p>';
                    return;
                }
                
                const sortedBookings = this.bookings
                    .sort((a, b) => {
                        // Sort by date first, then by start time
                        const dateComparison = new Date(a.date) - new Date(b.date);
                        if (dateComparison !== 0) return dateComparison;
                        
                        // Compare start times
                        const aStartTime = a.startTime || (a.time ? a.time.split(' - ')[0] : '00:00');
                        const bStartTime = b.startTime || (b.time ? b.time.split(' - ')[0] : '00:00');
                        return this.timeToMinutes(aStartTime) - this.timeToMinutes(bStartTime);
                    });
                
                allBookingsEl.innerHTML = sortedBookings.map(booking => {
                    const timeDisplay = this.getBookingTimeDisplay(booking);
                    const durationText = booking.duration ? ` (${booking.duration} hours)` : '';
                    
                    return `
                        <div class="admin-booking">
                            <h4>${booking.studentName} (${booking.studentId})</h4>
                            <p><strong>Date:</strong> ${booking.date}</p>
                            <p><strong>Time:</strong> ${timeDisplay}${durationText}</p>
                            <p><strong>Project:</strong> ${booking.projectType}</p>
                            <p><strong>Email:</strong> ${booking.email}</p>
                            ${booking.phone ? `<p><strong>Phone:</strong> ${booking.phone}</p>` : ''}
                            ${booking.purpose ? `<p><strong>Purpose:</strong> ${booking.purpose}</p>` : ''}
                            ${booking.equipment ? `<p><strong>Equipment:</strong> ${booking.equipment}</p>` : ''}
                            <button class="cancel-btn" onclick="bookingSystem.cancelBookingAdmin('${booking.id}')">
                                Cancel Booking
                            </button>
                        </div>
                    `;
                }).join('');
            }

            cancelBookingAdmin(bookingId) {
                if (confirm('Are you sure you want to cancel this booking?')) {
                    const booking = this.bookings.find(b => b.id == bookingId);
                    this.bookings = this.bookings.filter(b => b.id != bookingId);
                    this.saveBookings();
                    
                    // Send cancellation email
                    this.sendCancellationEmail(booking);
                    
                    this.showAlert('Booking cancelled successfully. Cancellation email sent.', 'success');
                    this.renderCalendar();
                    this.renderTimeSelection();
                    this.renderRecentBookings();
                    this.renderAdminPanel();
                }
            }

            cancelBooking(bookingId) {
                const booking = this.bookings.find(b => b.id == bookingId);
                
                // Check if student can cancel this booking
                if (!this.currentStudent && !this.isAdminAuthenticated) {
                    this.showAlert('You must be logged in to cancel bookings.', 'error');
                    return;
                }
                
                if (this.currentStudent && !this.isAdminAuthenticated) {
                    // Students can only cancel their own bookings
                    const canCancel = booking.studentAccountId === this.currentStudent.id ||
                                    (booking.studentId === this.currentStudent.studentId && !booking.studentAccountId);
                    
                    if (!canCancel) {
                        this.showAlert('You can only cancel your own bookings.', 'error');
                        return;
                    }
                }
                
                if (confirm('Are you sure you want to cancel this booking?')) {
                    this.bookings = this.bookings.filter(b => b.id != bookingId);
                    this.saveBookings();
                    
                    // Send cancellation email
                    this.sendCancellationEmail(booking);
                    
                    this.showAlert('Booking cancelled successfully. You will receive a cancellation confirmation email.', 'success');
                    this.renderCalendar();
                    this.renderTimeSelection();
                    this.renderRecentBookings();
                    
                    // Update admin panel if open
                    if (this.isAdminAuthenticated) {
                        this.renderAdminPanel();
                    }
                }
            }

            sendConfirmationEmail(booking) {
                this.showEmailStatus('Sending confirmation email...', 'sending');
                
                // Simulate email sending (replace with actual email service)
                setTimeout(() => {
                    try {
                        // In a real application, you would integrate with an email service like:
                        // - EmailJS
                        // - SendGrid
                        // - Nodemailer (backend)
                        
                        const emailContent = this.generateConfirmationEmail(booking);
                        console.log('Confirmation Email Content:', emailContent);
                        
                        // Simulate successful email sending
                        this.showEmailStatus('Confirmation email sent successfully!', 'sent');
                        
                        // Hide email status after 3 seconds
                        setTimeout(() => {
                            document.getElementById('emailStatus').style.display = 'none';
                        }, 3000);
                        
                    } catch (error) {
                        console.error('Email sending failed:', error);
                        this.showEmailStatus('Failed to send confirmation email. Please contact support.', 'failed');
                    }
                }, 1500); // Simulate network delay
            }

            sendCancellationEmail(booking) {
                // Simulate cancellation email sending
                setTimeout(() => {
                    try {
                        const emailContent = this.generateCancellationEmail(booking);
                        console.log('Cancellation Email Content:', emailContent);
                        
                        // In a real application, send actual email here
                        
                    } catch (error) {
                        console.error('Cancellation email sending failed:', error);
                    }
                }, 1000);
            }

            generateConfirmationEmail(booking) {
                const timeDisplay = this.getBookingTimeDisplay(booking);
                const durationText = booking.duration ? ` (${booking.duration} hour${booking.duration !== 1 ? 's' : ''})` : '';
                
                return {
                    to: booking.email,
                    subject: 'Photography Room Booking Confirmation',
                    html: `
                        <h2>üì∏ Room 7209 Booking Confirmation</h2>
                        <p>Dear ${booking.studentName},</p>
                        <p>Your Photography Room 7209 booking has been confirmed!</p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3>Booking Details:</h3>
                            <p><strong>Room:</strong> Photography Room 7209</p>
                            <p><strong>Date:</strong> ${booking.date}</p>
                            <p><strong>Time:</strong> ${timeDisplay}${durationText}</p>
                            <p><strong>Project Type:</strong> ${booking.projectType}</p>
                            <p><strong>Student ID:</strong> ${booking.studentId}</p>
                            ${booking.purpose ? `<p><strong>Purpose:</strong> ${booking.purpose}</p>` : ''}
                            ${booking.equipment ? `<p><strong>Equipment Requested:</strong> ${booking.equipment}</p>` : ''}
                        </div>
                        
                        <h3>Important Information:</h3>
                        <ul>
                            <li>Please arrive 15 minutes before your session</li>
                            <li>Bring your student ID for verification</li>
                            <li>Room 7209 is located on the 7th floor</li>
                            <li>Room is available from 9:00 AM to 4:30 PM daily</li>
                            <li>All equipment must be returned in the same condition</li>
                            <li>If you need to cancel, please do so at least 24 hours in advance</li>
                        </ul>
                        
                        <p>If you have any questions, please contact the photography department.</p>
                        <p>Thank you!</p>
                        
                        <p><em>Photography Room 7209 Booking System</em></p>
                    `
                };
            }

            generateCancellationEmail(booking) {
                const timeDisplay = this.getBookingTimeDisplay(booking);
                const durationText = booking.duration ? ` (${booking.duration} hour${booking.duration !== 1 ? 's' : ''})` : '';
                
                return {
                    to: booking.email,
                    subject: 'Photography Room Booking Cancellation',
                    html: `
                        <h2>üì∏ Room 7209 Booking Cancellation</h2>
                        <p>Dear ${booking.studentName},</p>
                        <p>Your Photography Room 7209 booking has been cancelled.</p>
                        
                        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3>Cancelled Booking Details:</h3>
                            <p><strong>Room:</strong> Photography Room 7209</p>
                            <p><strong>Date:</strong> ${booking.date}</p>
                            <p><strong>Time:</strong> ${timeDisplay}${durationText}</p>
                            <p><strong>Project Type:</strong> ${booking.projectType}</p>
                        </div>
                        
                        <p>You can make a new booking for Room 7209 anytime through our booking system.</p>
                        <p>Room is available from 9:00 AM to 4:30 PM daily with flexible booking durations.</p>
                        <p>If this cancellation was made in error, please contact us immediately.</p>
                        
                        <p><em>Photography Room 7209 Booking System</em></p>
                    `
                };
            }

            showEmailStatus(message, type) {
                const emailStatus = document.getElementById('emailStatus');
                emailStatus.textContent = message;
                emailStatus.className = `email-status ${type}`;
                emailStatus.style.display = 'block';
            }

            // Sidebar UI Management
            updateSidebarUI() {
                const userControls = document.getElementById('userControls');
                const leftSidebar = document.getElementById('leftSidebar');
                const userAvatar = document.getElementById('userAvatar');
                const sidebarUserName = document.getElementById('sidebarUserName');
                const sidebarUserType = document.getElementById('sidebarUserType');
                const sidebarMyBookings = document.getElementById('sidebarMyBookings');
                const sidebarAdminPanel = document.getElementById('sidebarAdminPanel');
                const sidebarManageStudents = document.getElementById('sidebarManageStudents');

                if (this.currentStudent || this.isAdminAuthenticated) {
                    // Hide top login buttons and show sidebar
                    userControls.classList.add('hidden');
                    leftSidebar.classList.add('show');

                    if (this.isAdminAuthenticated) {
                        // Admin logged in
                        const initials = this.currentAdminId ? this.currentAdminId.charAt(0).toUpperCase() : 'A';
                        userAvatar.textContent = initials;
                        userAvatar.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
                        sidebarUserName.textContent = this.currentAdminId || 'Admin';
                        sidebarUserType.textContent = 'Teacher/Admin';
                        
                        // Show admin options
                        sidebarMyBookings.style.display = 'none';
                        sidebarAdminPanel.style.display = 'block';
                        sidebarManageStudents.style.display = 'block';
                    } else if (this.currentStudent) {
                        // Student logged in
                        const initials = this.currentStudent.name.split(' ').map(n => n.charAt(0)).join('').substring(0, 2).toUpperCase();
                        userAvatar.textContent = initials;
                        userAvatar.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        sidebarUserName.textContent = this.currentStudent.name;
                        sidebarUserType.textContent = `Student (${this.currentStudent.studentId})`;
                        
                        // Show student options
                        sidebarMyBookings.style.display = 'block';
                        sidebarAdminPanel.style.display = 'none';
                        sidebarManageStudents.style.display = 'none';
                    }
                } else {
                    // Nobody logged in - show login buttons, hide sidebar
                    userControls.classList.remove('hidden');
                    leftSidebar.classList.remove('show');
                }
            }

            handleSidebarLogout() {
                if (this.isAdminAuthenticated) {
                    this.handleAdminLogout();
                } else if (this.currentStudent) {
                    this.handleStudentLogout();
                }
            }

            scrollToBookings() {
                const bookingsSection = document.querySelector('.bookings-list');
                if (bookingsSection) {
                    bookingsSection.scrollIntoView({ behavior: 'smooth' });
                }
            }

            changeMonth(delta) {
                this.currentDate.setMonth(this.currentDate.getMonth() + delta);
                this.renderCalendar();
            }

            renderCalendar() {
                const monthNames = [
                    'January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'
                ];
                
                document.getElementById('currentMonth').textContent = 
                    `${monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
                
                const grid = document.getElementById('calendarGrid');
                grid.innerHTML = '';
                
                // Day headers
                const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayHeaders.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });
                
                const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                const lastDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let i = 0; i < 42; i++) {
                    const cellDate = new Date(startDate);
                    cellDate.setDate(startDate.getDate() + i);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = cellDate.getDate();
                    
                    const dateStr = this.formatDate(cellDate);
                    const isCurrentMonth = cellDate.getMonth() === this.currentDate.getMonth();
                    const isPast = cellDate < today;
                    const isToday = cellDate.getTime() === today.getTime();
                    const isBooked = this.bookings.some(booking => booking.date === dateStr);
                    
                    if (!isCurrentMonth) {
                        dayElement.style.opacity = '0.3';
                    }
                    
                    if (isPast) {
                        dayElement.style.opacity = '0.3';
                        dayElement.style.cursor = 'not-allowed';
                    } else if (isToday) {
                        dayElement.classList.add('today');
                    }
                    
                    if (this.selectedDate === dateStr) {
                        dayElement.classList.add('selected');
                    }
                    
                    if (!isPast && isCurrentMonth) {
                        dayElement.addEventListener('click', () => this.selectDate(cellDate));
                    }
                    
                    grid.appendChild(dayElement);
                }
            }

            selectDate(date) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (date < today) return;
                
                this.selectedDate = this.formatDate(date);
                this.selectedStartTime = null;
                this.selectedEndTime = null;
                
                // Clear time inputs
                document.getElementById('startTime').value = '';
                document.getElementById('endTime').value = '';
                
                // Reset button-based time selection interface
                document.getElementById('startTimeSelection').style.display = 'block';
                document.getElementById('endTimeSelection').style.display = 'none';
                document.getElementById('durationDisplay').style.display = 'none';
                
                // Clear any button selections
                document.querySelectorAll('.time-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                this.renderCalendar();
                this.renderTimeSelection();
                this.validateForm();
            }

            renderTimeSelection() {
                if (!this.selectedDate) {
                    document.getElementById('bookingTimeline').style.display = 'none';
                    document.getElementById('durationDisplay').style.display = 'none';
                    document.getElementById('startTimeSelection').style.display = 'block';
                    document.getElementById('endTimeSelection').style.display = 'none';
                    return;
                }
                
                this.generateStartTimeButtons();
                this.renderTimeline();
            }

            generateStartTimeButtons() {
                const container = document.getElementById('startTimeButtons');
                container.innerHTML = '';
                
                // Generate 30-minute intervals from 9:00 AM to 4:00 PM (last start time that allows 1 hour minimum)
                const startHour = 9;
                const endHour = 16; // 4:00 PM (to allow for 4:30 PM end time)
                
                for (let hour = startHour; hour <= endHour; hour++) {
                    for (let minutes = 0; minutes < 60; minutes += 30) {
                        const timeString = `${hour.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                        
                        // Skip times that would not allow minimum 1-hour booking
                        if (hour === 16 && minutes === 30) continue; // Skip 4:30 PM start time
                        
                        const button = this.createTimeButton(timeString, 'start');
                        container.appendChild(button);
                    }
                }
            }

            generateEndTimeButtons(selectedStartTime) {
                const container = document.getElementById('endTimeButtons');
                container.innerHTML = '';
                
                const startMinutes = this.timeToMinutes(selectedStartTime);
                const roomCloseMinutes = this.timeToMinutes(this.roomCloseTime); // 4:30 PM
                const maxDurationMinutes = this.maxDurationHours * 60; // 7.5 hours
                
                // Calculate the latest possible end time
                const latestEndMinutes = Math.min(
                    roomCloseMinutes,
                    startMinutes + maxDurationMinutes
                );
                
                // Generate end time buttons starting from start time + 1 hour
                for (let minutes = startMinutes + 60; minutes <= latestEndMinutes; minutes += 30) {
                    const timeString = this.minutesToTime(minutes);
                    const button = this.createTimeButton(timeString, 'end');
                    container.appendChild(button);
                }
            }

            createTimeButton(timeString, type) {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'time-button';
                button.textContent = this.formatTimeDisplay(timeString);
                button.dataset.time = timeString;
                
                // Accessibility attributes
                button.setAttribute('aria-label', `Select ${this.formatTimeDisplay(timeString)} as ${type} time`);
                button.setAttribute('role', 'button');
                button.setAttribute('tabindex', '0');
                
                // Check if this time is conflicted
                const isConflicted = this.isTimeConflicted(timeString, type);
                
                if (isConflicted) {
                    button.classList.add('conflict');
                    button.disabled = true;
                    button.setAttribute('aria-disabled', 'true');
                    button.title = 'This time is already booked';
                    button.setAttribute('aria-label', `${this.formatTimeDisplay(timeString)} - unavailable (already booked)`);
                } else {
                    button.addEventListener('click', () => {
                        if (type === 'start') {
                            this.selectStartTime(timeString);
                        } else {
                            this.selectEndTime(timeString);
                        }
                    });
                    
                    // Keyboard navigation
                    button.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            button.click();
                        }
                    });
                }
                
                return button;
            }

            formatTimeDisplay(timeString) {
                const [hours, minutes] = timeString.split(':').map(Number);
                const period = hours >= 12 ? 'PM' : 'AM';
                const displayHours = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours;
                return `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
            }

            isTimeConflicted(timeString, type) {
                if (!this.selectedDate) return false;
                
                const timeMinutes = this.timeToMinutes(timeString);
                const dayBookings = this.bookings.filter(booking => booking.date === this.selectedDate);
                
                for (let booking of dayBookings) {
                    let bookingStart, bookingEnd;
                    
                    if (booking.startTime && booking.endTime) {
                        bookingStart = this.timeToMinutes(booking.startTime);
                        bookingEnd = this.timeToMinutes(booking.endTime);
                    } else if (booking.time && booking.time.includes(' - ')) {
                        const [start, end] = booking.time.split(' - ');
                        bookingStart = this.timeToMinutes(start);
                        bookingEnd = this.timeToMinutes(end);
                    } else {
                        continue;
                    }
                    
                    if (type === 'start') {
                        // Start time conflicts if it falls within an existing booking
                        if (timeMinutes >= bookingStart && timeMinutes < bookingEnd) {
                            return true;
                        }
                    } else {
                        // End time conflicts if it falls within an existing booking
                        if (timeMinutes > bookingStart && timeMinutes <= bookingEnd) {
                            return true;
                        }
                    }
                }
                
                return false;
            }

            selectStartTime(timeString) {
                // Clear any previous selections
                document.querySelectorAll('#startTimeButtons .time-button').forEach(btn => {
                    btn.classList.remove('selected');
                    btn.setAttribute('aria-pressed', 'false');
                });
                
                // Mark selected button
                const selectedButton = document.querySelector(`#startTimeButtons .time-button[data-time="${timeString}"]`);
                selectedButton.classList.add('selected');
                selectedButton.setAttribute('aria-pressed', 'true');
                
                // Store selection
                this.selectedStartTime = timeString;
                document.getElementById('startTime').value = timeString;
                
                // Show end time selection
                document.getElementById('endTimeSelection').style.display = 'block';
                document.getElementById('startTimeDisplay').textContent = this.formatTimeDisplay(timeString);
                
                // Generate end time buttons
                this.generateEndTimeButtons(timeString);
                
                // Clear any previous end time selection
                this.selectedEndTime = null;
                document.getElementById('endTime').value = '';
                document.getElementById('durationDisplay').style.display = 'none';
                
                // Focus management - move to end time selection
                setTimeout(() => {
                    const firstEndTimeButton = document.querySelector('#endTimeButtons .time-button:not(.conflict)');
                    if (firstEndTimeButton) {
                        firstEndTimeButton.focus();
                    }
                }, 100);
                
                // Announce to screen readers
                this.announceToScreenReader(`Start time selected: ${this.formatTimeDisplay(timeString)}. Please select an end time.`);
                
                this.validateForm();
            }

            selectEndTime(timeString) {
                // Clear any previous selections
                document.querySelectorAll('#endTimeButtons .time-button').forEach(btn => {
                    btn.classList.remove('selected');
                    btn.setAttribute('aria-pressed', 'false');
                });
                
                // Mark selected button
                const selectedButton = document.querySelector(`#endTimeButtons .time-button[data-time="${timeString}"]`);
                selectedButton.classList.add('selected');
                selectedButton.setAttribute('aria-pressed', 'true');
                
                // Store selection
                this.selectedEndTime = timeString;
                document.getElementById('endTime').value = timeString;
                
                // Validate the time selection
                const validation = this.validateTimeSelection(this.selectedStartTime, timeString);
                
                if (!validation.valid) {
                    this.showAlert(validation.message, 'error');
                    this.selectedEndTime = null;
                    document.getElementById('endTime').value = '';
                    document.getElementById('durationDisplay').style.display = 'none';
                    selectedButton.classList.remove('selected');
                    selectedButton.setAttribute('aria-pressed', 'false');
                    this.validateForm();
                    return;
                }
                
                // Check for conflicts
                const conflict = this.checkTimeConflict(this.selectedStartTime, timeString);
                if (conflict) {
                    this.showAlert(`Time conflict! Room is already booked from ${conflict.startTime} to ${conflict.endTime}.`, 'error');
                    this.selectedEndTime = null;
                    document.getElementById('endTime').value = '';
                    document.getElementById('durationDisplay').style.display = 'none';
                    selectedButton.classList.remove('selected');
                    selectedButton.setAttribute('aria-pressed', 'false');
                    this.validateForm();
                    return;
                }
                
                // Valid selection - calculate and display duration
                const duration = this.calculateDuration(this.selectedStartTime, timeString);
                document.getElementById('durationText').textContent = `${duration} hour${duration !== 1 ? 's' : ''}`;
                document.getElementById('durationDisplay').style.display = 'block';
                
                // Update timeline
                this.renderTimeline();
                this.validateForm();
                
                // Announce success to screen readers
                this.announceToScreenReader(`Booking time selected: ${this.formatTimeDisplay(this.selectedStartTime)} to ${this.formatTimeDisplay(timeString)}, duration ${duration} hour${duration !== 1 ? 's' : ''}. You may now complete your booking.`);
                
                // Show success feedback
                this.showAlert(`Selected: ${this.formatTimeDisplay(this.selectedStartTime)} - ${this.formatTimeDisplay(timeString)} (${duration} hour${duration !== 1 ? 's' : ''})`, 'success');
            }

            resetTimeSelection() {
                // Clear selections
                this.selectedStartTime = null;
                this.selectedEndTime = null;
                document.getElementById('startTime').value = '';
                document.getElementById('endTime').value = '';
                
                // Reset UI
                document.getElementById('endTimeSelection').style.display = 'none';
                document.getElementById('durationDisplay').style.display = 'none';
                
                // Clear button selections
                document.querySelectorAll('.time-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                // Regenerate start time buttons
                this.generateStartTimeButtons();
                this.renderTimeline();
                this.validateForm();
            }

            handleTimeSelection() {
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                
                if (!startTime || !endTime) {
                    document.getElementById('durationDisplay').style.display = 'none';
                    this.selectedStartTime = null;
                    this.selectedEndTime = null;
                    this.validateForm();
                    this.renderTimeline();
                    return;
                }

                // Validate time selection
                const validation = this.validateTimeSelection(startTime, endTime);
                
                if (!validation.valid) {
                    this.showAlert(validation.message, 'error');
                    // Clear invalid selection
                    document.getElementById('endTime').value = '';
                    document.getElementById('durationDisplay').style.display = 'none';
                    this.selectedStartTime = null;
                    this.selectedEndTime = null;
                    this.validateForm();
                    this.renderTimeline();
                    return;
                }

                // Check for conflicts with existing bookings
                const conflict = this.checkTimeConflict(startTime, endTime);
                if (conflict) {
                    this.showAlert(`Time conflict! Room is already booked from ${conflict.startTime} to ${conflict.endTime}.`, 'error');
                    document.getElementById('endTime').value = '';
                    document.getElementById('durationDisplay').style.display = 'none';
                    this.selectedStartTime = null;
                    this.selectedEndTime = null;
                    this.validateForm();
                    this.renderTimeline();
                    return;
                }

                // Valid selection
                this.selectedStartTime = startTime;
                this.selectedEndTime = endTime;
                
                // Calculate and display duration
                const duration = this.calculateDuration(startTime, endTime);
                document.getElementById('durationText').textContent = `${duration} hour${duration !== 1 ? 's' : ''}`;
                document.getElementById('durationDisplay').style.display = 'block';
                
                this.renderTimeline();
                this.validateForm();
            }

            validateTimeSelection(startTime, endTime) {
                // Convert times to minutes for easier calculation
                const startMinutes = this.timeToMinutes(startTime);
                const endMinutes = this.timeToMinutes(endTime);
                const roomOpenMinutes = this.timeToMinutes(this.roomOpenTime);
                const roomCloseMinutes = this.timeToMinutes(this.roomCloseTime);

                // Check if start time is before end time
                if (startMinutes >= endMinutes) {
                    return { valid: false, message: 'End time must be after start time.' };
                }

                // Check if times are within room operating hours
                if (startMinutes < roomOpenMinutes) {
                    return { valid: false, message: 'Start time must be at or after 9:00 AM.' };
                }

                if (endMinutes > roomCloseMinutes) {
                    return { valid: false, message: 'End time must be at or before 4:30 PM.' };
                }

                // Check if times are in 30-minute increments
                if (startMinutes % 30 !== 0) {
                    return { valid: false, message: 'Start time must be in 30-minute increments (e.g., 9:00, 9:30, 10:00).' };
                }

                if (endMinutes % 30 !== 0) {
                    return { valid: false, message: 'End time must be in 30-minute increments (e.g., 9:30, 10:00, 10:30).' };
                }

                // Check minimum duration (1 hour = 60 minutes)
                const durationMinutes = endMinutes - startMinutes;
                if (durationMinutes < 60) {
                    return { valid: false, message: 'Minimum booking duration is 1 hour.' };
                }

                // Check maximum duration (7.5 hours = 450 minutes)
                if (durationMinutes > 450) {
                    return { valid: false, message: 'Maximum booking duration is 7.5 hours.' };
                }

                return { valid: true };
            }

            checkTimeConflict(startTime, endTime) {
                if (!this.selectedDate) return null;

                const newStartMinutes = this.timeToMinutes(startTime);
                const newEndMinutes = this.timeToMinutes(endTime);

                // Check against existing bookings for this date
                const dayBookings = this.bookings.filter(booking => booking.date === this.selectedDate);

                for (let booking of dayBookings) {
                    // Handle both old format (time range) and new format (startTime/endTime)
                    let bookingStartMinutes, bookingEndMinutes;
                    
                    if (booking.startTime && booking.endTime) {
                        // New format
                        bookingStartMinutes = this.timeToMinutes(booking.startTime);
                        bookingEndMinutes = this.timeToMinutes(booking.endTime);
                    } else if (booking.time && booking.time.includes(' - ')) {
                        // Old format (legacy support)
                        const [start, end] = booking.time.split(' - ');
                        bookingStartMinutes = this.timeToMinutes(start);
                        bookingEndMinutes = this.timeToMinutes(end);
                    } else {
                        continue; // Skip invalid booking formats
                    }

                    // Check for overlap: new booking starts before existing ends AND new booking ends after existing starts
                    if (newStartMinutes < bookingEndMinutes && newEndMinutes > bookingStartMinutes) {
                        return {
                            startTime: this.minutesToTime(bookingStartMinutes),
                            endTime: this.minutesToTime(bookingEndMinutes)
                        };
                    }
                }

                return null;
            }

            timeToMinutes(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }

            minutesToTime(minutes) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
            }

            calculateDuration(startTime, endTime) {
                const startMinutes = this.timeToMinutes(startTime);
                const endMinutes = this.timeToMinutes(endTime);
                return (endMinutes - startMinutes) / 60;
            }

            renderTimeline() {
                if (!this.selectedDate) return;

                const timelineContent = document.getElementById('timelineContent');
                const timeline = document.getElementById('bookingTimeline');
                
                timeline.style.display = 'block';
                timelineContent.innerHTML = '';

                // Create timeline for each 30-minute segment from 9 AM to 4:30 PM
                for (let hour = 9; hour <= 16; hour++) {
                    for (let halfHour = 0; halfHour < 2; halfHour++) {
                        // Stop at 4:30 PM
                        if (hour === 16 && halfHour === 1) break;
                        
                        const segmentDiv = document.createElement('div');
                        segmentDiv.className = 'timeline-hour';
                        segmentDiv.style.height = '30px'; // Smaller height for 30-min segments
                        
                        const timeLabel = document.createElement('div');
                        timeLabel.className = 'timeline-time';
                        const minutes = halfHour * 30;
                        timeLabel.textContent = `${hour}:${minutes.toString().padStart(2, '0')}`;
                        
                        const timeBar = document.createElement('div');
                        timeBar.className = 'timeline-bar';
                        
                        // Check for bookings in this 30-minute segment
                        const segmentStart = hour * 60 + minutes;
                        const segmentEnd = segmentStart + 30;
                        
                        const dayBookings = this.bookings.filter(booking => booking.date === this.selectedDate);
                        
                        for (let booking of dayBookings) {
                            let bookingStart, bookingEnd;
                            
                            if (booking.startTime && booking.endTime) {
                                bookingStart = this.timeToMinutes(booking.startTime);
                                bookingEnd = this.timeToMinutes(booking.endTime);
                            } else if (booking.time && booking.time.includes(' - ')) {
                                const [start, end] = booking.time.split(' - ');
                                bookingStart = this.timeToMinutes(start);
                                bookingEnd = this.timeToMinutes(end);
                            } else {
                                continue;
                            }
                            
                            // Check if booking overlaps with this 30-minute segment
                            if (bookingStart < segmentEnd && bookingEnd > segmentStart) {
                                const overlapStart = Math.max(bookingStart, segmentStart);
                                const overlapEnd = Math.min(bookingEnd, segmentEnd);
                                const startPercent = ((overlapStart - segmentStart) / 30) * 100;
                                const widthPercent = ((overlapEnd - overlapStart) / 30) * 100;
                                
                                const bookingDiv = document.createElement('div');
                                bookingDiv.className = 'timeline-booking';
                                bookingDiv.style.left = startPercent + '%';
                                bookingDiv.style.width = widthPercent + '%';
                                bookingDiv.textContent = 'Booked';
                                bookingDiv.title = `${booking.studentName}: ${this.minutesToTime(bookingStart)} - ${this.minutesToTime(bookingEnd)}`;
                                
                                timeBar.appendChild(bookingDiv);
                            }
                        }
                        
                        // Show selected time range
                        if (this.selectedStartTime && this.selectedEndTime) {
                            const selectedStart = this.timeToMinutes(this.selectedStartTime);
                            const selectedEnd = this.timeToMinutes(this.selectedEndTime);
                            
                            if (selectedStart < segmentEnd && selectedEnd > segmentStart) {
                                const overlapStart = Math.max(selectedStart, segmentStart);
                                const overlapEnd = Math.min(selectedEnd, segmentEnd);
                                const startPercent = ((overlapStart - segmentStart) / 30) * 100;
                                const widthPercent = ((overlapEnd - overlapStart) / 30) * 100;
                                
                                const selectedDiv = document.createElement('div');
                                selectedDiv.className = 'timeline-selected';
                                selectedDiv.style.left = startPercent + '%';
                                selectedDiv.style.width = widthPercent + '%';
                                selectedDiv.textContent = 'Selected';
                                
                                timeBar.appendChild(selectedDiv);
                            }
                        }
                        
                        segmentDiv.appendChild(timeLabel);
                        segmentDiv.appendChild(timeBar);
                        timelineContent.appendChild(segmentDiv);
                    }
                }
            }

            validateForm() {
                const form = document.getElementById('bookingForm');
                const inputs = form.querySelectorAll('input[required], select[required]');
                let isValid = true;
                
                inputs.forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                    }
                });
                
                isValid = isValid && this.selectedDate && this.selectedStartTime && this.selectedEndTime;
                
                document.getElementById('bookBtn').disabled = !isValid;
            }

            handleBookingSubmit(e) {
                e.preventDefault();
                
                // Require student login for booking
                if (!this.currentStudent) {
                    this.showAlert('Please log in or create a student account to make a booking.', 'error');
                    return;
                }
                
                const timeStr = `${this.selectedStartTime} - ${this.selectedEndTime}`;
                const duration = this.calculateDuration(this.selectedStartTime, this.selectedEndTime);
                
                const booking = {
                    id: Date.now(),
                    studentAccountId: this.currentStudent.id, // Associate with student account
                    date: this.selectedDate,
                    time: timeStr, // Keep for backwards compatibility
                    startTime: this.selectedStartTime,
                    endTime: this.selectedEndTime,
                    duration: duration,
                    studentName: this.currentStudent.name,
                    studentId: this.currentStudent.studentId,
                    email: this.currentStudent.email,
                    phone: document.getElementById('phone').value,
                    projectType: document.getElementById('projectType').value,
                    purpose: document.getElementById('purpose').value,
                    equipment: document.getElementById('equipment').value,
                    createdAt: new Date().toISOString()
                };
                
                this.bookings.push(booking);
                this.saveBookings();
                
                // Send confirmation email
                this.sendConfirmationEmail(booking);
                
                this.showAlert(`Booking confirmed successfully! Room reserved for ${duration} hour${duration !== 1 ? 's' : ''}.`, 'success');
                
                // Reset form (except personal info which stays filled)
                document.getElementById('phone').value = '';
                document.getElementById('projectType').value = '';
                document.getElementById('purpose').value = '';
                document.getElementById('equipment').value = '';
                document.getElementById('startTime').value = '';
                document.getElementById('endTime').value = '';
                
                this.selectedDate = null;
                this.selectedStartTime = null;
                this.selectedEndTime = null;
                
                document.getElementById('durationDisplay').style.display = 'none';
                document.getElementById('bookingTimeline').style.display = 'none';
                
                this.renderCalendar();
                this.renderTimeSelection();
                this.renderRecentBookings();
                this.validateForm();
            }

            renderRecentBookings() {
                const container = document.getElementById('recentBookings');
                let relevantBookings = [];
                
                if (this.currentStudent) {
                    // Show only current student's bookings
                    relevantBookings = this.bookings.filter(booking => 
                        booking.studentAccountId === this.currentStudent.id ||
                        (booking.studentId === this.currentStudent.studentId && !booking.studentAccountId) // Legacy bookings
                    );
                } else {
                    // No bookings shown if not logged in
                    relevantBookings = [];
                }
                
                const recentBookings = relevantBookings
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                    .slice(0, 5);
                
                if (recentBookings.length === 0) {
                    if (this.currentStudent) {
                        container.innerHTML = '<p style="color: #666; text-align: center;">You have no bookings yet</p>';
                    } else {
                        container.innerHTML = '<p style="color: #666; text-align: center;">Please log in to see your bookings</p>';
                    }
                    return;
                }
                
                container.innerHTML = recentBookings.map(booking => {
                    const timeDisplay = this.getBookingTimeDisplay(booking);
                    const durationText = booking.duration ? ` (${booking.duration}h)` : '';
                    
                    return `
                        <div class="booking-item">
                            <div class="booking-date">${booking.date} at ${timeDisplay}${durationText}</div>
                            <div class="booking-details">${booking.studentName} - ${booking.projectType}</div>
                            <button class="cancel-booking" onclick="bookingSystem.cancelBooking('${booking.id}')">
                                Cancel
                            </button>
                        </div>
                    `;
                }).join('');
            }

            getBookingTimeDisplay(booking) {
                if (booking.startTime && booking.endTime) {
                    // New format
                    return `${booking.startTime} - ${booking.endTime}`;
                } else if (booking.time) {
                    // Legacy format
                    return booking.time;
                } else {
                    return 'Time not specified';
                }
            }

            showAlert(message, type) {
                const alert = document.getElementById('alert');
                alert.textContent = message;
                alert.className = `alert ${type}`;
                alert.style.display = 'block';
                
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 5000);
            }

            formatDate(date) {
                return date.toISOString().split('T')[0];
            }

            loadBookings() {
                const saved = localStorage.getItem('photographyRoom7209Bookings');
                return saved ? JSON.parse(saved) : [];
            }

            saveBookings() {
                localStorage.setItem('photographyRoom7209Bookings', JSON.stringify(this.bookings));
            }

            loadStudents() {
                const saved = localStorage.getItem('photographyRoom7209Students');
                return saved ? JSON.parse(saved) : [];
            }

            saveStudents() {
                localStorage.setItem('photographyRoom7209Students', JSON.stringify(this.students));
            }

            announceToScreenReader(message) {
                // Create a live region for screen reader announcements
                let liveRegion = document.getElementById('screenReaderAnnouncements');
                if (!liveRegion) {
                    liveRegion = document.createElement('div');
                    liveRegion.id = 'screenReaderAnnouncements';
                    liveRegion.setAttribute('aria-live', 'polite');
                    liveRegion.setAttribute('aria-atomic', 'true');
                    liveRegion.style.position = 'absolute';
                    liveRegion.style.left = '-9999px';
                    liveRegion.style.width = '1px';
                    liveRegion.style.height = '1px';
                    liveRegion.style.overflow = 'hidden';
                    document.body.appendChild(liveRegion);
                }
                
                // Clear and set the message
                liveRegion.textContent = '';
                setTimeout(() => {
                    liveRegion.textContent = message;
                }, 100);
                
                // Clear after announcement
                setTimeout(() => {
                    liveRegion.textContent = '';
                }, 3000);
            }
        }

        // Initialize the booking system when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.bookingSystem = new BookingSystem();
        });
    </script>
</body>
</html>